const scriptName = "주식";
const randomN = [10, 9, 8, 7, 6, 5, 4, 3, 2, 1, 0, -1, -2, -3, -4, -5, -6, -7, -8, -9, -10];
const Ad = ['3.141592653589793238462643383279502884197169399375105820974944...', '";내정보",";구매" 등 일부 명령어는 가입후 사용할수 있답니다!', '주가는 5분 마다 자동으로 갱신됩니다!', '몰?루'];
var allsee = new Array(1000).join(String.fromCharCode(847));
const ECFDo = [0, 1, 2, 3, 4, 5, 6, 7, 8, 9];
const TREo = [0, 1, 2, 3, 4, 5, 6, 7, 8, 9, 10, 11, 12];
const EN = ['A', 'B', 'C', 'D', 'E', 'F', 'G', 'H', 'I', 'J', 'K', 'L', 'M', 'N', 'O', 'P', 'Q', 'R', 'S', 'T', 'U', 'V', 'W', 'X', 'Y', 'Z'];
const randomNum = [0, 1, 2, 3, 4, 5, 6, 7, 8, 9];
const Ch = [-3, -2.5, -2, -1.5, -1, 0, 0.5, 1, 1.5, 2, 2.5, 3];
const TIme_outBa = ['🌘 10초 감소! 🌒', '⭐ 25초 감소! ⭐', '🌗 50초 감소! 🌓', '🌈 Infinity초 감소 라고할뻔! 🌈\n75초 감소', '🔥 100초 감소! 💧', '⌛ 200초 감소! ⌛', '⏳ 200초 감소! ⏳'];
const title1 = ['주린이', '빨리 빼!', '조사 중...', '회사가 망했어', '매수매도 타이밍 초짜', '여유자금=0원', '경제가 머죠?', '떨어짐 오늘 안자', '아이고ㅠ', '푼돈'];
const title2 = ['🌋 화산 마스터 🌋', '🚦 신호등 🚦', '🌈 무지개 🌈', '💧 물과 불을 다루는 자 🔥', '§ See Truth §', 'ı Believe The Truth And Act ı', '⏱ Time Line ⏱', '🌘 The Moon 🌒','✅ 정답만 믿는자 ✅' ,'❎ 오답만 믿는자 ❎'];
const title3 = ['ö Pig ö', '<\귀 여 미 />', '</커엽다\>', '<-| 멍충이 |->', '% 이사람 운 업대요 ㅋㅋ %', '_ 줘좸민의아니라고요 _', '🧊 아이스에이지 🧊', '</어쩔티비\>'];
const title4 = ['⚔︎해적⚔︎', '☢︎방사능☢︎', '🕦🕥🕤🕘🕒 The World 🕣🕐🕝🕖🕢', '⛩ 차이나타운 ⛩', '🥑 Avocados from the Mexico 🥑', '☕ 갈땐 가더라도 커피 한잔은 괜찮잖아? ☕', '🍉 수밖 🍉'];
const title5 = ['⚔️전쟁의 신 아레스⚔️', '☭블라디미르 레닌☭', '📈마스터 오브 코인📉', '📚지식의 신 토트📚', '🖥테크노 킹🖥', '🛸외계인🛸'];
const titlerendomNum1 = [1, 2, 3, 4, 5, 6, 7, 8, 9, 10, 11, 11, 12, 13, 14, 15, 16, 17, 18, 19, 20, 21, 22, 23, 24, 25, 26, 27, 28, 29, 30, 31, 32, 33, 34, 35, 36, 37, 38, 39, 40, 41, 42, 43, 44, 45];
const titlerendomNum2 = [46, 47, 48, 49, 50, 51, 52, 53, 54, 55, 56, 57, 58, 59, 60, 61, 62, 63, 64, 65, 66, 67, 68, 69, 70];
const titlerendomNum3 = [71, 72, 73, 74, 75, 76, 77, 78, 79, 80, 81, 82, 83, 84, 85];
const titlerendomNum4 = [86, 87, 88, 89, 90, 91, 92, 93, 94, 95];
const titlerendomNum5 = [96, 97, 98, 99, 100];
const titlerendomNum = [1, 2, 3, 4, 5, 6, 7, 8, 9, 10, 11, 12, 13, 14, 15, 16, 17, 18, 19, 20, 21, 22, 23, 24, 25, 26, 27, 28, 29, 30, 31, 32, 33, 34, 35, 36, 37, 38, 39, 40, 41, 42, 43, 43, 44, 45, 46, 47, 48, 49, 50, 51, 52, 53, 54, 55, 56, 57, 58, 59, 60, 61, 62, 63, 64, 65, 66, 67, 68, 69, 70, 71, 72, 73, 74, 75, 76, 77, 78, 79, 80, 81, 82, 83, 84, 85, 86, 87, 88, 89, 90, 91, 92, 93, 94, 95, 96, 97, 98, 99, 100];

/**
 * (string) room
 * (string) sender
 * (boolean) isGroupChat
 * (void) replier.reply(message)
 * (boolean) replier.reply(room, message, hideErrorToast = false) // 전송 성공시 true, 실패시 false 반환
 * (string) imageDB.getProfileBase64()
 * (string) packageName
 */

setZ = setTimeout(function() {
  Y = 10;
  FCab = 0;
  Timeii = 300;
  Time_randomii = 3600;
  ZrandomTime = 0;
  Zb = 0;
  OOT = 0;
}, 10);
time_out = setInterval(function() {
  if (Timeii == 0) {
  Ro = randomN[Math.floor((Math.random() * 9))];
  FCab = Ro;
  let Zo = Ro + Y;
  Y = Zo;
  Zb = 0;
  Timeii = 300;
  } else {
    Timeii = Timeii-1;
  }
}, 1000);
Time_random = setInterval(function() {
  ZrandomTime = 0;
  Time_randomii = 3600;
}, 6000000);
Time_random_out = setInterval(function() {
  Time_randomii = Time_randomii-1;
}, 1000);

function response(room, msg, sender, isGroupChat, replier, imageDB, packageName) {
  try {
    var roomlist = DataBase.getDataBase('roomlist').split('\n');
  }catch(e) {
    var roomlist = [''];
  }
  try {
    var Adminlist = DataBase.getDataBase('Adminlist').split('\n');
  }catch(e) {
    var Adminlist = [''];
  }
  if (roomlist.includes(room)) {
    if (msg == ';주가') {
      N = 0;
      if (Y > N) {
        let Kk = Ad[Math.floor((Math.random() * 4))];
        replier.reply('[ 현재 주가 ]\n' + "'" + Y + "$' 입니다.\n변동폭 : " + FCab + '$\n\n다음 갱신까지 ' + Timeii + '초\n\n[ AD ]\n'+Kk);
      } else if(N > Y) {
        let To = 10;
        Y = To;
        replier.reply('주가가 "0" 이하로 떨어져 주가를 재설정합니다.');
      }
    }
    if (msg == ';주가재설정'){
      let To = 10;
      Y = To;
      FCab = 0;
    }
    if (msg == ';주가강제변동') {
      if (Zb == 0) {
      let Ro = randomN[Math.floor((Math.random() * 9))];
      FCab = Ro;
      let Zo = Ro + Y;
      Y = Zo;
      Zb = 1;
      replier.reply('주가가 강제 변동 되었습니다.');
      } else if (Zb == 1) {
        replier.reply('주가 강제 변동은 자동으로 주가가 변동된후 1회만 실행할수있습니다.');
      }
    }
    if (msg == ';도움말'||msg == ';help'||msg == ';?') {
      replier.reply('[ ¿도움말? ]\n'+allsee+'\n<명령어 리스트>\n;가입\n;주가\n;내정보\n;구매\n;판매\n;일괄판매\n;단축\n;도박\n;주가강제변동\n;주가랜덤설정\n;주가재설정\n;code\n;단축\n\n<패치노트>\n1.";단축",";도박"명령어가 추가되었습니다.(도박명령어는 ";도박 100" 이런식으로 쓸수 있습니다');
    }
    if (msg == ';code') {
      replier.reply('https://bit.ly/3ON1onn');
    }
    if (msg == ';주가랜덤설정') {
      if (ZrandomTime > 0) {
        replier.reply('주가랜덤 설정은 1시간에 1번만 변경 가능합니다. - 남은시간 '+Time_randomii+'초');
      } else if (ZrandomTime < 1) {
      let GHo = ECFDo[Math.floor((Math.random() * 10))];
      let HGo = ECFDo[Math.floor((Math.random() * 10))];
      let THo = TREo[Math.floor((Math.random() * 13))]
      let ECo = GHo+HGo;
      let CEo = ECo*THo;
      Y = CEo;
      replier.reply('주가가 랜덤으로 설정되었습니다.\n설정된 주가는 "' + Y + '$"입니다.');
      ZrandomTime = 1;
      }
    }
    try {
      var joinbot = DataBase.getDataBase('Zo가입리스트001').split('\n');
    }catch(e) {
      var joinbot = [''];
    }
    if (msg == ';가입') {
      if (joinbot.includes(sender)) {
        replier.reply('이미 가입하셨습니다.');
        return ;
      } else if (sender.includes('\n')||sender.includes('@')||sender.includes('\'')) {
        replier.reply('일부 특수문자가 포함된 닉네임은 가입이 불가능합니다.');
        return ;
      } else
      DataBase.setDataBase('Zo가입리스트001', DataBase.getDataBase('Zo가입리스트001')+'\n'+sender);
      DataBase.setDataBase('roomlist', DataBase.getDataBase('roomlist')+'\n'+sender);
      setting(sender);
      replier.reply('성공적으로 등록되었습니다. (도움말은 ";도움말",";help",";?"를 입력하면 나온답니다!');
      return ;
    }
    if (joinbot.includes(sender)) {
      if (msg == ';내정보') {
        if (joinbot.includes(sender)) {
          show_important(sender, replier);
        } else {
          replier.reply('가입을 하고 사용해주세요. (명령어 : ;가입)');
        }
      }
      var message = msg.split(' ');
      if (message[0] == ';구매') {
        money = Number(DataBase.getDataBase('Z '+sender+ 'is money'));
        var cutting = msg.replace(';구매 ', '');
        if (isNaN(Number(cutting))) {
          replier.reply('숫자를 입력해주세요.');
          return ;
        } else if (Number(cutting)<0) {
          replier.reply('음수로 설정하실수 없습니다');
          return ;
        } else if (Number(cutting)>money) {
          replier.reply('돈이 부족합니다.');
          return ;
        } else if (Number(cutting)>100) {
          replier.reply('주식은 한번에 100개 이하로만 거래 가능합니다.');
          return ;
        } else {
          if (joinbot.includes(sender)) {
            money = Number(DataBase.getDataBase('Z '+sender+ 'is money'));
            ZZuo = Number(DataBase.getDataBase('Z '+sender+ 'is Z'));
            var ZYPo = Y*message[1];
            var ZYPn = Number(message[1]);
            if (money < ZYPo) {
              replier.reply('돈이 부족합니다. - 현재 잔액 : ' + money);
            } else if (money >= ZYPo) {
              DataBase.setDataBase('Z '+sender+ 'is money', money-ZYPo);
              DataBase.setDataBase('Z '+sender+ 'is Z', ZZuo+ZYPn);
              money = Number(DataBase.getDataBase('Z '+sender+ 'is money'));
              ZZuo = Number(DataBase.getDataBase('Z '+sender+ 'is Z'));
              replier.reply('성공적으로 구매되었습니다. \n잔액 : ' + money + '\n보유한 주식 개수 : ' + ZZuo);
            } else {
            replier.reply('가입을 하고 사용해주세요. (명령어 : ;가입)');
            }
          }
        }
      }
      if (msg == ';판매') {
        if (joinbot.includes(sender)) {
          money = Number(DataBase.getDataBase('Z '+sender+ 'is money'));
          ZZuo = Number(DataBase.getDataBase('Z '+sender+ 'is Z'));
          if (ZZuo > 0) {
            DataBase.setDataBase('Z '+sender+ 'is money', money+Y);
            DataBase.setDataBase('Z '+sender+ 'is Z', ZZuo-1);
            money = Number(DataBase.getDataBase('Z '+sender+ 'is money'));
            ZZuo = Number(DataBase.getDataBase('Z '+sender+ 'is Z'));
            replier.reply('성공적으로 구매되었습니다. \n 잔액 : ' + money + '\n보유한 주식 개수 : ' + ZZuo);
          } else if (ZZuo == 0) {
            replier.reply('보유한 주식의 개수가 0개입니다.');
          }
        } else {
          replier.reply('가입을 하고 사용해주세요. (명령어 : ;가입)');
        }
      } 
      if (msg == ';일괄판매') {
        if (joinbot.includes(sender)) {
          money = Number(DataBase.getDataBase('Z '+sender+ 'is money'));
          ZZuo = Number(DataBase.getDataBase('Z '+sender+ 'is Z'));
          if (ZZuo > 0) {
            KJo = ZZuo*Y;
            DataBase.setDataBase('Z '+sender+ 'is money', money+KJo);
            DataBase.setDataBase('Z '+sender+ 'is Z', 0);
            replier.reply('성공적으로 판매되었습니다.');
          } else if (ZZuo == 0) {
            replier.reply('보유한 주식의 개수가 0개 입니다.');
          }
        } else {
          replier.reply('가입을 하고 사용해주세요. (명령어 : ;가입)');
        }
      }
      if (msg == ';단축') {
        if (OOT == 0) {
          var dustksdee = TIme_outBa[Math.floor((Math.random() * 7))];
          let gkgkgk = Ad[Math.floor((Math.random() * 4))];
          let streee = '\n\n[ AD ]\n';
          var setrrrr = dustksdee+streee+gkgkgk;
          let a = TIme_outBa[0];
          let b = TIme_outBa[1];
          let c = TIme_outBa[2];
          let d = TIme_outBa[3];
          let e = TIme_outBa[4];
          let f = TIme_outBa[5];
          let g = TIme_outBa[6];
          replier.reply(setrrrr);
          OOT = 1;
          if (dustksdee == a) {
            Timeii = Timeii-10;
          } else if (dustksdee == b) {
            Timeii = Timeii-25;
          } else if (dustksdee == c) {
            Timeii = Timeii-50;
          } else if (dustksdee == d) {
            Timeii = Timeii-75;
          } else if (dustksdee == e) {
            Timeii = Timeii-100;
          } else if (dustksdee == f) {
            Timeii = Timeii-200;
          } else if (dustksdee == g) {
            Timeii = Timeii-300;
          }
        } else if (OOT == 1) {
          replier.reply('단축은 주가가 변동된후 1번만 가능합니다.');
        }
      }
      if (message[0] == ';주가설정') {
        if (Adminlist.includes(sender)) {
          let cutting = msg.replace(';주가설정 ', '');
        if (isNaN(Number(cutting))) {
          replier.reply('숫자만 적어주세요.');
        } else {
          Y = cutting;
          replier.reply('주가가 '+cutting+'으로 설정되었습니다.');
        }
      }
      }
      if (message[0] == ';칭호') {
        let cutting = msg.replace(';칭호 ', '');
        if (cutting == '목록') {
          replier.reply('[ 칭호 목록 ]\n'+allsee+'\n일반 : '+title1+'\n\n고급 : '+title2+'\n\n희귀 : '+title3+'\n\n유일 : '+title4+'\n\n신화 : '+title5);
        } else if (cutting == '구매') {
          money = DataBase.getDataBase('Z '+sender+ 'is money');
          if (money >= 500) {
            DataBase.setDataBase('Z '+sender+ 'is money', money-500);
            let RkDk = titlerendomNum[Math.floor(Math.random() * 100)];
            if (titlerendomNum1.includes(RkDk)) {
              let RkDk1 = title1[Math.floor(Math.random() * 10)];
              try {
                var titlelist = DataBase.getDataBase('Z '+sender+ 'is title').split('\n');
              }catch(e) {
                var titlelist = [''];
              }
              if (titlelist.includes(RkDk1)) {
                replier.reply('칭호가 중복으로 뽑혔습니다. 50%를 돌려드리겠습니다.');
                DataBase.setDataBase('Z '+sender+ 'is money', money);
              } else {
              DataBase.setDataBase('Z '+sender+ 'is title', DataBase.getDataBase('Z '+sender+ 'is title')+'\n'+RkDk1);
              replier.reply(sender+'님이 뽑으신 칭호는 "'+RkDk1+'" 입니다.');
              }
            } else if (titlerendomNum2.includes(RkDk)) {
              let RkDk2 = title2[Math.floor(Math.random() * 10)];
              try {
                var titlelist = DataBase.getDataBase('Z '+sender+ 'is title').split('\n');
              }catch(e) {
                var titlelist = [''];
              }
              if (titlelist.includes(RkDk2)) {
                replier.reply('칭호가 중복으로 뽑혔습니다. 50%를 돌려드리겠습니다.');
                DataBase.setDataBase('Z '+sender+ 'is money', money)
              } else {
              DataBase.setDataBase('Z '+sender+ 'is title', DataBase.getDataBase('Z '+sender+ 'is title')+'\n'+RkDk2);
              replier.reply(sender+'님이 뽑으신 칭호는 "'+RkDk2+'" 입니다.');
              }
            } else if (titlerendomNum3.includes(RkDk)) {
              let RkDk3 = title3[Math.floor(Math.random() * 8)];
              try {
                var titlelist = DataBase.getDataBase('Z '+sender+ 'is title').split('\n');
              }catch(e) {
                var titlelist = [''];
              }
              if (titlelist.includes(RkDk3)) {
                replier.reply('칭호가 중복으로 뽑혔습니다. 50%를 돌려드리겠습니다.');
                DataBase.setDataBase('Z '+sender+ 'is money', money);
              } else {
              DataBase.setDataBase('Z '+sender+ 'is title', DataBase.getDataBase('Z '+sender+ 'is title')+'\n'+RkDk3);
              replier.reply(sender+'님이 뽑으신 칭호는 "'+RkDk3+'" 입니다.');
              }
            } else if (titlerendomNum4.includes(RkDk)) {
              let RkDk4 = title4[Math.floor(Math.random() * 7)];
              try {
                var titlelist = DataBase.getDataBase('Z '+sender+ 'is title').split('\n');
              }catch(e) {
                var titlelist = [''];
              }
              if (titlelist.includes(RkDk4)) {
                replier.reply('칭호가 중복으로 뽑혔습니다. 50%를 돌려드리겠습니다.');
                DataBase.setDataBase('Z '+sender+ 'is money', money);
              } else {
              DataBase.setDataBase('Z '+sender+ 'is title', DataBase.getDataBase('Z '+sender+ 'is title')+'\n'+RkDk4);
              replier.reply(sender+'님이 뽑으신 칭호는 "'+RkDk4+'" 입니다.');
              }
            } else if (titlerendomNum5.includes(RkDk)) {
              let RkDk5 = title5[Math.floor(Math.random() * 6)];
              try {
                var titlelist = DataBase.getDataBase('Z '+sender+ 'is title').split('\n');
              }catch(e) {
                var titlelist = [''];
              }
              if (titlelist.includes(RkDk5)) {
                replier.reply('칭호가 중복으로 뽑혔습니다. 50%를 돌려드리겠습니다.');
                DataBase.setDataBase('Z '+sender+ 'is money', money);
              } else {
              DataBase.setDataBase('Z '+sender+ 'is title', DataBase.getDataBase('Z '+sender+ 'is title')+'\n'+RkDk5);
              replier.reply(sender+'님이 뽑으신 칭호는 "'+RkDk5+'" 입니다.');
              }
            }
          } else if (money < 500) {
            replier.reply('돈이 부족합니다. - 잔액 : '+money);
          }
        } else if (cutting == '내칭호') {
          title = DataBase.getDataBase('Z '+sender+ 'is title');
          replier.reply('[ '+sender+'님의 보유하신 칭호 ]\n'+allsee+'\n\n' + title);
        }
      }
      if (message[0] == ';도박') {
        if (isGroupChat == true) {
          replier.reply('갠톡에서 해주세요.');
        } else if (isGroupChat == false) {
          let cutting = msg.replace(';도박 ', '');
          money = Number(DataBase.getDataBase('Z '+sender+ 'is money'));
          if (isNaN(Number(cutting))) {
            replier.reply('숫자만 적어주세요.');
          } else if (Number(cutting)<0) {
            replier.reply('음수로 설정하실수 없습니다.');
          } else if (Number(cutting)>money) {
            replier.reply('돈이 부족합니다.');
          } else {
            let DPRo = Ch[Math.floor(Math.random() * 7)];
            let DPRa = Number(DPRo*cutting);
            let AD = Ad[Math.floor(Math.random() * 4)];
            DataBase.setDataBase('Z '+sender+ 'is money', money+DPRo);
            let money1 = Number(DataBase.getDataBase('Z '+sender+ 'is money'));
            let ths = DPRa-cutting;
            replier.reply('[ '+sender+'님의 도박 결과 ]\n'+allsee+'\n투자금액 : '+cutting+'$\n\n돈 : '+money+'$ ➡️ '+money1+'$\n\n손익 : '+ths+'$\n\n'+AD);
          }
        }
      }
    } else {
      replier.reply('가입을 하고 사용해주세요. (명령어 : ;가입)')
    }
  }
}

function onStart(activity) {}

function onResume(activity) {}

function onPause(activity) {}

function onStop(activity) {}

function setting(sender) {
  DataBase.setDataBase('Z '+sender+ 'is money', '20');
  DataBase.setDataBase('Z '+sender+ 'is Z', '1');
}

function show_important(sender, replier) {
  text = '¤돈 : ' +DataBase.getDataBase('Z '+sender+ 'is money')+'$';
  teet = '¤주식 : ' +DataBase.getDataBase('Z '+sender+ 'is Z')+'개';

  replier.reply('[ ' + sender + '님의 정보 ]\n' + text + '\n' + teet);
}